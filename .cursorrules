# Project Rules

## Tech Stack & Environment
- Framework: Next.js (App Router), React
- Language: TypeScript (.ts, .tsx)
- Database: Supabase (PostgreSQL)
- Style: Tailwind CSS
- Shell: Windows PowerShell (Use `;` for chain, avoid Linux commands like `export`, `rm -rf`)

## AI Behavior & Cost Saving
- **No New Docs:** 新機能のために新しいMarkdownファイル(.md)を作成しないでください。計画はチャット内で行ってください。
- **Code Focused:** 日本語の長文解説よりも、実際のコード変更を優先して提示してください。
- **Existing Files:** 既存の `PROJECT_ARCHITECTURE_GUIDE.md` は、アーキテクチャに大きな変更がある場合のみ更新してください。

## Error Prevention
- **Type Safety:** コード変更時は必ず型チェックを意識し、`any`型を避けてください。
- **Build Verification:** 提案するコードは、ビルドが通る整合性の取れたものであることを確認してください。
- **PowerShell:** コマンド提案時はPowerShell構文を使用してください。

## Communication
- すべて日本語で応答してください。
- コード内のコメントも日本語で記述してください。

## Self-Improvement & Rule Maintenance
- **Propose Updates:** エラー修正やトラブルシューティングが完了した後、もしその原因が「コンテキスト不足」や「曖昧な指示」にあった場合、今後同じミスを防ぐためにこの `.cursorrules` に追記すべきルールを提案してください。
- **Format:** 提案がある場合は、回答の最後に「【.cursorrulesへの追加提案】」として別枠で表示してください。

## Verification Strategy
- **Routine Check:** 通常のコード修正後は `npm run build` を実行せず、`npx tsc --noEmit` で型整合性のみを確認してください。
- **Pre-Push Check:** 大きなタスクの完了時や、Gitへプッシュする直前のみ、`npm run build` を実行してVercelデプロイ時の失敗を防いでください。

## Error Handling & Debugging
- **Read Terminal:** ビルドエラーや実行時エラーが発生した場合、ユーザーからのコピペを待たずに、自動的にターミナルの出力を分析して修正案を提示してください。
- **Root Cause:** エラー修正時は、単にエラーを消すだけでなく「なぜそのエラーが起きたか」の根本原因を日本語で簡潔に説明してください。

## UI Guidelines: Form & Legibility Fixes

**既存のデザインバランスは維持しつつ、「入力フォーム」と「小さな補足テキスト」の視認性のルールを考慮ください。**

1.  **入力フォーム (Input, Textarea, Select) のルール:**
    * ユーザーが入力する値（Value）は、**必ず `text-gray-900` (ほぼ黒)** を指定する。
    * プレースホルダーのみ `placeholder-gray-500` を使用する。
    * **Bad:** `<input className="text-gray-500 ...">`
    * **Good:** `<input className="text-gray-900 placeholder-gray-400 ...">`


## Code Maintenance & Refactoring Guidelines

**修正を行う際は、既存の機能を破壊しない（デグレードを防ぐ）ことを最優先する。デグレードの危険性がある場合は必ず追加提案をする**

1.  **既存ロジックの保護 (Preserve Existing Logic):**
    * エラー修正や機能追加を行う際、**指示された箇所以外のコードを変更・削除してはならない。**
    * 特に条件分岐 (`if`, `switch`) や計算ロジックは、明示的な変更指示がない限り、元のロジックを完全に維持する。
    * 「コードをきれいにする」という理由だけで、動作確認されていない短縮記法への書き換えを行わない。

2.  **省略の禁止 (No Lazy Truncation):**
    * コード全体を出力する際、`// ... existing code` や `// ... rest of the component` のように既存コードを省略してはならない。
    * 省略されると、前回までの修正が失われる原因となるため、必ず全文を出力するか、変更部分のみを正確に提示する。

3.  **リファクタリング時の移動ルール (Safe Extraction):**
    * コンポーネントや関数を別ファイルに切り出す際は、以下の依存関係がすべて移動先に含まれているか確認する：
        * 必要な `import` 文
        * 定義された `interface` / `type`
        * 使用されている `useState` / `useEffect` / `hooks`
    * 親コンポーネントに残すべきものと、移動すべきものを厳密に区別し、Propsの受け渡し漏れがないか確認する。

4.  **修正の検証 (Verify Changes):**
    * コードを提示する前に、「この修正によって、既存の機能 A や B が動かなくならないか？」を自問する。
    * 以前の修正（特にスタイリングやバリデーション）が上書きされていないか確認する。