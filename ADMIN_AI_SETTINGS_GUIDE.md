# ç®¡ç†è€…ç”¨AIãƒ¢ãƒ‡ãƒ«è¨­å®šæ©Ÿèƒ½ - å®Œå…¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ æ¦‚è¦

ç®¡ç†è€…ãŒãƒã‚¤ãƒšãƒ¼ã‚¸ã§ãƒ—ãƒ©ãƒ³åˆ¥ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆAIãƒ¢ãƒ‡ãƒ«ã‚’ã€Œå€™è£œAã€ã¾ãŸã¯ã€Œå€™è£œBã€ã‹ã‚‰é¸æŠã§ãã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

## ğŸ¯ å®Ÿè£…æ¸ˆã¿ã®æ©Ÿèƒ½

### 1. ãƒ—ãƒ©ãƒ³åˆ¥AIãƒ¢ãƒ‡ãƒ«ãƒ—ãƒªã‚»ãƒƒãƒˆå®šç¾©

**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/ai-provider.ts`

å„ãƒ—ãƒ©ãƒ³ã«2ã¤ã®ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆå€™è£œA/å€™è£œBï¼‰ã‚’å®šç¾©ï¼š

| ãƒ—ãƒ©ãƒ³ | å€™è£œA | å€™è£œB | æ¨å¥¨ |
|-------|-------|-------|------|
| **Lite** | ã‚³ã‚¹ãƒˆç‰¹åŒ–ï¼ˆFlash-Liteï¼‰ | ãƒãƒ©ãƒ³ã‚¹ï¼ˆFlashï¼‰ | B â­ |
| **Standard** | åˆ©ç›Šé‡è¦–ï¼ˆFlash + Haikuï¼‰ | å“è³ªé‡è¦–ï¼ˆHaiku + Flashï¼‰ | B â­ |
| **Pro** | è«–ç†é‡è¦–ï¼ˆo3-miniï¼‰ | æƒ…ç·’é‡è¦–ï¼ˆSonnet + Haikuï¼‰ | A â­ |
| **Business** | æœ€é«˜å³°ï¼ˆo1 + Sonnetï¼‰ | æ¨è«–ç‰¹åŒ–ï¼ˆSonnet + o1ï¼‰ | A â­ |

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase_admin_ai_settings.sql`

- `admin_ai_settings` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- ãƒ—ãƒ©ãƒ³åˆ¥ã®ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠã‚’ä¿å­˜
- RPCé–¢æ•° `get_ai_setting_for_plan()` - è¨­å®šå–å¾—
- RPCé–¢æ•° `update_ai_setting()` - è¨­å®šæ›´æ–°

### 3. ç®¡ç†è€…ç”¨API

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/admin/ai-settings/route.ts`

- `GET /api/admin/ai-settings?planTier=xxx` - ãƒ—ãƒ©ãƒ³åˆ¥è¨­å®šå–å¾—
- `POST /api/admin/ai-settings` - è¨­å®šæ›´æ–°

### 4. ç®¡ç†è€…ç”¨UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `components/shared/AdminAISettings.tsx`

- ãƒ—ãƒ©ãƒ³é¸æŠã‚¿ãƒ–
- å€™è£œA/å€™è£œB ã®æ¯”è¼ƒã‚«ãƒ¼ãƒ‰è¡¨ç¤º
- ãƒ¢ãƒ‡ãƒ«æƒ…å ±ãƒ»ã‚³ã‚¹ãƒˆè¡¨ç¤º
- ä¿å­˜æ©Ÿèƒ½

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```sql
-- Supabase Studioã§å®Ÿè¡Œ
-- supabase_admin_ai_settings.sql ã®å†…å®¹ã‚’å®Ÿè¡Œ
```

ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ãŒä½œæˆã•ã‚Œã¾ã™ï¼š
- `admin_ai_settings` ãƒ†ãƒ¼ãƒ–ãƒ«
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šï¼ˆå…¨ãƒ—ãƒ©ãƒ³ã§presetBãŒåˆæœŸé¸æŠï¼‰
- RPCé–¢æ•°

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ç®¡ç†è€…è¨­å®šã‚’è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/dashboard/page.tsx`

```typescript
// ã‚¤ãƒ³ãƒãƒ¼ãƒˆè¿½åŠ 
import AdminAISettings from '@/components/shared/AdminAISettings';

// ç®¡ç†è€…å°‚ç”¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½åŠ 
{isAdmin && (
  <div className="mb-8">
    <AdminAISettings userId={user.id} />
  </div>
)}
```

### ã‚¹ãƒ†ãƒƒãƒ—3: AIç”Ÿæˆæ™‚ã«ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šã‚’ä½¿ç”¨

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/kdl/generate-section/route.ts` ãªã©

```typescript
import { getProviderForPlanAndPreset } from '@/lib/ai-provider';
import { getSubscriptionStatus } from '@/lib/subscription';

// AIç”Ÿæˆé–¢æ•°å†…
const subscription = await getSubscriptionStatus(user_id);
const planTier = subscription.planTier;

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šå–å¾—
const { data } = await supabase
  .from('admin_ai_settings')
  .select('selected_preset')
  .eq('plan_tier', planTier)
  .single();

const preset = data?.selected_preset || 'presetB';

// ãƒ—ãƒªã‚»ãƒƒãƒˆã«åŸºã¥ã„ã¦AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å–å¾—
const provider = getProviderForPlanAndPreset(planTier, preset, 'writing');

const response = await provider.generate({
  messages: [...],
});
```

## ğŸ“Š ãƒ—ãƒªã‚»ãƒƒãƒˆè©³ç´°

### Liteãƒ—ãƒ©ãƒ³ï¼ˆÂ¥2,980/æœˆï¼‰

#### å€™è£œA: ã‚³ã‚¹ãƒˆç‰¹åŒ–
- **æ§‹æˆ**: Gemini 2.0 Flash-Lite ($0.30)
- **åŸ·ç­†**: Gemini 2.0 Flash-Lite ($0.30)
- **ç‰¹å¾´**: åœ§å€’çš„ã«å®‰ã„ãŒã€æŒ‡ç¤ºç†è§£åº¦ãŒä½ã„

#### å€™è£œB: ãƒãƒ©ãƒ³ã‚¹ â­ æ¨å¥¨
- **æ§‹æˆ**: Gemini 2.0 Flash ($0.40)
- **åŸ·ç­†**: Gemini 2.0 Flash ($0.40)
- **ç‰¹å¾´**: Flashã§çµ±ä¸€ã€‚é–‹ç™ºå·¥æ•°çš„ã«ã‚‚å“è³ªçš„ã«ã‚‚æœ€é©

### Standardãƒ—ãƒ©ãƒ³ï¼ˆÂ¥4,980/æœˆï¼‰

#### å€™è£œA: åˆ©ç›Šé‡è¦–
- **æ§‹æˆ**: Gemini 2.0 Flash ($0.40)
- **åŸ·ç­†**: Claude 3 Haiku ($1.25)
- **ç‰¹å¾´**: Flashã§æ§‹æˆã€Haikuã§èª­ã¿ã‚„ã™ã„æ–‡ç« 

#### å€™è£œB: å“è³ªé‡è¦– â­ æ¨å¥¨
- **æ§‹æˆ**: Claude 3 Haiku ($1.25)
- **åŸ·ç­†**: Gemini 2.0 Flash ($0.40)
- **ç‰¹å¾´**: äººé–“å‘³ã®ã‚ã‚‹æ§‹æˆã€å¤§é‡ã®æ–‡ç« ç”ŸæˆãŒå¯èƒ½

### Proãƒ—ãƒ©ãƒ³ï¼ˆÂ¥9,800/æœˆï¼‰

#### å€™è£œA: è«–ç†é‡è¦– â­ æ¨å¥¨
- **æ§‹æˆ**: OpenAI o3-mini ($4.40)
- **åŸ·ç­†**: OpenAI o3-mini ($4.40)
- **ç‰¹å¾´**: å£²ã‚Œã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã¨è³¢ã„åŸ·ç­†ã€‚ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒé«˜ã„

#### å€™è£œB: æƒ…ç·’é‡è¦–
- **æ§‹æˆ**: Claude 3.5 Sonnet ($15.00)
- **åŸ·ç­†**: Claude 3 Haiku ($1.25)
- **ç‰¹å¾´**: ã‚¨ãƒ¢ã„æ§‹æˆã€‚æ§‹æˆã«é«˜ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹

### Businessãƒ—ãƒ©ãƒ³ï¼ˆÂ¥29,800/æœˆï¼‰

#### å€™è£œA: æœ€é«˜å³° â­ æ¨å¥¨
- **æ§‹æˆ**: OpenAI o1 ($60.00)
- **åŸ·ç­†**: Claude 3.5 Sonnet ($15.00)
- **ç‰¹å¾´**: æœ€é«˜ã®æ§‹æˆã¨æœ€é«˜å“è³ªã®æ–‡ç« 

#### å€™è£œB: æ¨è«–ç‰¹åŒ–
- **æ§‹æˆ**: Claude 3.5 Sonnet ($15.00)
- **åŸ·ç­†**: OpenAI o1 ($60.00)
- **ç‰¹å¾´**: æ·±ã„æ¨è«–åŸ·ç­†ã€‚åŸ·ç­†ãŒé…ã„ãŸã‚æ³¨æ„

## ğŸ¨ UIè¡¨ç¤ºä¾‹

ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®è¡¨ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ—ãƒ©ãƒ³åˆ¥AIãƒ¢ãƒ‡ãƒ«è¨­å®š                              â”‚
â”‚  å„ãƒ—ãƒ©ãƒ³ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆAIãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã§ãã¾ã™          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Lite] [Standard] [Pro] [Business]  â† ãƒ—ãƒ©ãƒ³é¸æŠã‚¿ãƒ–

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å€™è£œA: åˆ©ç›Šé‡è¦–        â”‚  â”‚  å€™è£œB: å“è³ªé‡è¦– âœ“    â”‚
â”‚                       â”‚  â”‚                       â”‚
â”‚  æ§‹æˆï¼ˆè„³ï¼‰              â”‚  â”‚  æ§‹æˆï¼ˆè„³ï¼‰              â”‚
â”‚  Gemini Flash         â”‚  â”‚  Claude Haiku         â”‚
â”‚  $0.40               â”‚  â”‚  $1.25               â”‚
â”‚                       â”‚  â”‚                       â”‚
â”‚  åŸ·ç­†ï¼ˆæ‰‹ï¼‰              â”‚  â”‚  åŸ·ç­†ï¼ˆæ‰‹ï¼‰              â”‚
â”‚  Claude Haiku         â”‚  â”‚  Gemini Flash         â”‚
â”‚  $1.25               â”‚  â”‚  $0.40               â”‚
â”‚                       â”‚  â”‚                       â”‚
â”‚                       â”‚  â”‚  â­ æ¨å¥¨è¨­å®š            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    [Standardãƒ—ãƒ©ãƒ³ã®è¨­å®šã‚’ä¿å­˜]
```

## ğŸ” å‹•ä½œç¢ºèª

### 1. ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§è¨­å®šè¡¨ç¤ºç¢ºèª

```typescript
// ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«
console.log('Current plan:', selectedPlan);
console.log('Current preset:', selectedPreset);
```

### 2. APIå‹•ä½œç¢ºèª

```bash
# è¨­å®šå–å¾—
curl http://localhost:3000/api/admin/ai-settings?planTier=standard

# è¨­å®šæ›´æ–°
curl -X POST http://localhost:3000/api/admin/ai-settings \
  -H "Content-Type: application/json" \
  -d '{"planTier":"standard","selectedPreset":"presetA","userId":"xxx"}'
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª

```sql
-- å…¨ãƒ—ãƒ©ãƒ³ã®è¨­å®šç¢ºèª
SELECT plan_tier, selected_preset FROM admin_ai_settings;

-- ç‰¹å®šãƒ—ãƒ©ãƒ³ã®è¨­å®š
SELECT * FROM admin_ai_settings WHERE plan_tier = 'standard';
```

## âš ï¸ æ³¨æ„äº‹é …

### ã‚³ã‚¹ãƒˆç®¡ç†

1. **Proãƒ—ãƒ©ãƒ³ã®åŸ·ç­†ã«Sonnetä½¿ç”¨æ™‚**
   - 1å†Šã®åŸä¾¡: æ•°åå††ã€œç™¾å††
   - 100å†Š/æ—¥ã§å¤§èµ¤å­—ã®ãƒªã‚¹ã‚¯
   - æ¨å¥¨: o3-miniä½¿ç”¨

2. **Businessãƒ—ãƒ©ãƒ³ã®ç„¡åˆ¶é™å¯¾å¿œ**
   - o1 + Sonnetã¯é«˜ã‚³ã‚¹ãƒˆ
   - æœˆé¡æ–™é‡‘ãŒæ•°æ—¥ã§æ¶ˆãˆã‚‹å¯èƒ½æ€§
   - ãƒªãƒŸãƒƒãƒˆç®¡ç†ã®æ¤œè¨ãŒå¿…è¦

### ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å¯¾å¿œ

ç¾åœ¨ã€ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å¯¾å¿œï¼š
- OpenAI (o1, o3-mini)
- Anthropic (Claude Sonnet, Haiku)
- Google (Gemini Flash, Flash-Lite)

Anthropic APIã‚­ãƒ¼ã®è¿½åŠ ãŒå¿…è¦ãªå ´åˆï¼š
```bash
# .env.local
ANTHROPIC_API_KEY=sk-ant-xxxxx
```

## ğŸ“ˆ ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

1. **ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«è¨­å®š**
   - ç®¡ç†è€…ãŒç‹¬è‡ªã«ãƒ¢ãƒ‡ãƒ«åã‚’æŒ‡å®š
   - Enterpriseãƒ—ãƒ©ãƒ³å‘ã‘

2. **ã‚³ã‚¹ãƒˆåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**
   - ãƒ—ãƒ©ãƒ³åˆ¥ãƒ»ãƒ¢ãƒ‡ãƒ«åˆ¥ã®ä½¿ç”¨é‡
   - ã‚³ã‚¹ãƒˆäºˆæ¸¬

3. **A/Bãƒ†ã‚¹ãƒˆæ©Ÿèƒ½**
   - ãƒ—ãƒªã‚»ãƒƒãƒˆA/Bã®å“è³ªæ¯”è¼ƒ
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼è©•ä¾¡ã®åé›†

4. **å‹•çš„ä¾¡æ ¼èª¿æ•´**
   - APIã‚³ã‚¹ãƒˆã«å¿œã˜ãŸè‡ªå‹•ãƒ—ãƒ©ãƒ³èª¿æ•´

---

**å®Ÿè£…æ—¥**: 2026-01-10  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å®Œå…¨å®Ÿè£…æ¸ˆã¿  
**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ â†’ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±åˆ

